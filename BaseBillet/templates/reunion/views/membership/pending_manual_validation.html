{% load i18n static %}

<!-- Contenu de confirmation pour remplacement de l'offcanvas -->
<div id="membership-pending-content" class="p-3">
    <div class="d-flex flex-column gap-3">
        <div class="alert alert-success mb-0" role="alert">
            <h5 class="alert-heading mb-1">{% trans "Demande d'adhésion enregistrée" %}</h5>
            <p class="mb-0">{% trans "Votre demande d'adhésion a bien été enregistrée et est maintenant en attente de validation par un administrateur." %}</p>
        </div>

        <div class="card">
            <div class="card-body">
                <h6 class="card-subtitle text-muted mb-2">{% trans "Récapitulatif" %}</h6>
                <ul class="list-unstyled mb-0">
                    <li>
                        <strong>{% trans "Produit" %}:</strong>
                        {{ membership.price.product.name }} — {{ membership.price.name }}
                    </li>
                    {% if membership.contribution_value %}
                        <li>
                            <strong>{% trans "Montant" %}:</strong>
                            {{ membership.contribution_value }} €
                        </li>
                    {% elif membership.price.prix %}
                        <li>
                            <strong>{% trans "Montant" %}:</strong>
                            {{ membership.price.prix }} €
                        </li>
                    {% endif %}
                    <li>
                        <strong>{% trans "Date de demande" %}:</strong>
                        {{ membership.date_added|date:'d/m/Y H:i' }}
                    </li>
                </ul>
            </div>
        </div>

        {% if membership.price.prix and membership.price.prix|floatformat:2 != '0.00' %}
            <div class="alert alert-info mb-0" role="alert">
                {% trans "Dès validation, un lien de paiement vous sera envoyé par email." %}
            </div>
        {% endif %}

        {% if membership.user and not membership.user.email_valid %}
            <div class="alert alert-warning mb-0" role="alert">
                {% trans "Votre adresse email n'est pas encore validée. Pour être sûr de recevoir nos messages, validez-la maintenant. Pensez à regarder dans vos spam au cas ou !" %}
{#                <div class="mt-2">#}
{#                    <a class="btn btn-sm btn-warning" href="/my_account/resend_activation_email/">#}
{#                        {% trans "Valider mon email" %}#}
{#                    </a>#}
{#                </div>#}
            </div>
        {% endif %}

        <div class="d-flex justify-content-end gap-2">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="offcanvas">
                {% trans "Fermer" %}
            </button>
            <a href="/memberships/" class="btn btn-primary">
                {% trans "Voir toutes les adhésions" %}
            </a>
        </div>
    </div>
</div>

<script type="module">
    import * as Spinner from '{% static "reunion/js/form-spinner.mjs" %}'
    // hide spinner if present
    try { Spinner.hideSpinner && Spinner.hideSpinner(); } catch (e) {}

    // Déplace le contenu dans l'offcanvas pour remplacer le formulaire
    const content = document.getElementById('membership-pending-content');
    const container = document.getElementById('offcanvas-membership');
    if (content && container) {
        container.innerHTML = '';
        container.appendChild(content);
        // S'assurer que l'offcanvas est bien visible
        try {
            const oc = bootstrap.Offcanvas.getOrCreateInstance('#subscribePanel');
            oc && oc.show();
        } catch (e) {}
    }
</script>
