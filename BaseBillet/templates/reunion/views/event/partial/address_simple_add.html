{% load i18n %}

{# Formulaire simple pour créer une nouvelle adresse (lieu) #}
{# FALC: On remplit les champs ci-dessous puis on clique sur "Créer le lieu". #}

<div class="mb-3">
  <p class="lead mb-1">{% translate "Créer un nouveau lieu" %}</p>
  <ul class="small text-muted mb-2">
    <li>{% translate "Un lieu est une adresse postale où se déroule l'évènement." %}</li>
    <li>{% translate "Vous pourrez le réutiliser ensuite pour d'autres évènements." %}</li>
  </ul>
  <p class="small text-muted mb-0">
    <span class="text-danger" aria-hidden="true">*</span>
    <span class="visually-hidden">{% translate 'Champ obligatoire' %}</span>
    {% translate "signale un champ obligatoire." %}
  </p>
</div>

<form
  hx-post="/event/address_create/"
  hx-encoding="multipart/form-data"
  hx-target="#offcanvas-event-admin"
  hx-swap="innerHTML"
  enctype="multipart/form-data"
>
  {% csrf_token %}

  {# Bloc d'erreurs global (FALC) : affiche toutes les erreurs remontées par le serveur #}
  {% if errors %}
    <div class="alert alert-danger" role="alert">
      <p class="mb-1">{% translate "Veuillez corriger les erreurs suivantes :" %}</p>
      <ul class="mb-0">
        {% for field, msgs in errors.items %}
          {% for msg in msgs %}
            <li><strong>{{ field }}</strong>: {{ msg }}</li>
          {% endfor %}
        {% endfor %}
      </ul>
    </div>
  {% endif %}


  <div class="row g-3">
    <div class="col-md-8">
      <label for="name" class="form-label">
        {% translate "Nom du lieu" %}
        <span class="text-danger" aria-hidden="true">*</span>
        <span class="visually-hidden">{% translate 'Champ obligatoire' %}</span>
      </label>
      <input type="text" class="form-control" id="name" name="name" required value="{{ prefill.name|default:'' }}">
      <div class="form-text">{% translate "Exemple: Grande salle, Salle du bas, Accueil... Aide à retrouver le lieu." %}</div>
      {% if errors.name %}
        <div class="text-danger small mt-1">{{ errors.name|join:', ' }}</div>
      {% endif %}
    </div>
    <div class="col-md-4">
      <label for="is_main" class="form-label">{% translate "Adresse principale" %}</label>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="is_main" name="is_main" {% if prefill.is_main %}checked{% endif %}>
        <label class="form-check-label" for="is_main">{% translate "Cocher si c'est l'adresse par défaut" %}</label>
      </div>
    </div>
  </div>

  <div class="mt-3">
    <label for="img" class="form-label">{% translate "Image du lieu (optionnel)" %}</label>
    <input class="form-control" type="file" id="img" name="img" accept="image/*">
    <div class="form-text">{% translate "Affichée si l'évènement n'a pas d'image. Formats standard acceptés." %}</div>
    {% if errors.img %}
      <div class="text-danger small mt-1">{{ errors.img|join:', ' }}</div>
    {% endif %}
  </div>

  <div class="mt-3">
    <label for="street_address" class="form-label">
      {% translate "Adresse (numéro et rue)" %}
      <span class="text-danger" aria-hidden="true">*</span>
      <span class="visually-hidden">{% translate 'Champ obligatoire' %}</span>
    </label>
    <textarea class="form-control" id="street_address" name="street_address" rows="2" required>{{ prefill.street_address|default:'' }}</textarea>
    <div class="form-text">{% translate "Exemple: 10 rue des Fleurs" %}</div>
    {% if errors.streetAddress %}
      <div class="text-danger small mt-1">{{ errors.streetAddress|join:', ' }}</div>
    {% endif %}
  </div>

  <div class="row g-3 mt-1">
    <div class="col-md-6">
      <label for="address_locality" class="form-label">
        {% translate "Ville" %}
        <span class="text-danger" aria-hidden="true">*</span>
        <span class="visually-hidden">{% translate 'Champ obligatoire' %}</span>
      </label>
      <input type="text" class="form-control" id="address_locality" name="address_locality" required value="{{ prefill.address_locality|default:'' }}">
      {% if errors.addressLocality %}
        <div class="text-danger small mt-1">{{ errors.addressLocality|join:', ' }}</div>
      {% endif %}
    </div>
    <div class="col-md-6">
      <label for="postal_code" class="form-label">
        {% translate "Code postal" %}
        <span class="text-danger" aria-hidden="true">*</span>
        <span class="visually-hidden">{% translate 'Champ obligatoire' %}</span>
      </label>
      <input type="text" class="form-control" id="postal_code" name="postal_code" required value="{{ prefill.postal_code|default:'' }}">
      {% if errors.postalCode %}
        <div class="text-danger small mt-1">{{ errors.postalCode|join:', ' }}</div>
      {% endif %}
    </div>
  </div>

  <div class="d-flex gap-2 mt-4">
    <button type="submit" class="btn btn-primary">
      <i class="bi bi-check2-circle"></i> {% translate "Créer le lieu" %}
    </button>
    <button type="button" class="btn btn-outline-secondary"
            hx-get="/event/simple_add_event/"
            hx-target="#offcanvas-event-admin"
            hx-swap="innerHTML">
      {% translate "Retour" %}
    </button>
  </div>

</form>
