{% load static i18n %}
{% load laboutik_process %}

<div id="messages" class="BF-col">
	<h1 class="message-title">{% translate "Types de paiement" %}</h1>
	<!-- cashless -->
	{% if 'nfc' in moyens_paiement %}
	<c-bt.paiement name='{% translate "CASHLESS" %}' icon="fa-address-card" hx-get="hx_read_nfc" hx-on:click="modifyPaymentNfc()" />
	{% endif %}

	<!-- espèce, pas une consigne -->
	{% if 'espece' in moyens_paiement %}
	<c-bt.paiement name='{% translate "ESPÈCE" %}' icon="fa-coins" hx-get="hx_confirm_payment?method=espece"/>
	{% endif %}

	<!-- TODO: espèce, une consigne: espèce à rendre, depositIsPresent -->
	{% if 'espece' in moyens_paiement %}
	{% endif %}

	<!-- carte bancaire -->
	{% if 'carte_bancaire' in moyens_paiement %}
	<c-bt.paiement name='{% translate "CB" %}' icon="fa-credit-card" hx-get="hx_confirm_payment?method=carte_bancaire"/>
	{% endif %}

	<!-- cheque -->
	{% if 'CH' in moyens_paiement %}
	<c-bt.paiement name='{% translate "CHÈQUE" %}' icon="fa-money-check" hx-get="hx_confirm_payment?method=CH"/>
	{% endif %}

	<!-- bouton "OFFRIR"  en mode gérant uniquement masi pas pour le point de ventes "CASHLESS" -->

	<!-- pas de moyens de paiement -->
	{% if moyens_paiement|length == 0%}
	<h3 style="color: var(--warning);">{% translate "Aucun moyen de paiement" %}</h3>
	{% endif %}

	<!-- include bt_return.html -->
	 <c-bt.return />
</div>

<script>
	function modifyPaymentNfc() {
		// console.log('-> modifyPaymentNfc')
		document.querySelector('#addition-moyen-paiement').value = 'nfc'
		const form = document.querySelector('#addition-form')
		// change le trigger de form #addition-form pour "nfcResult"
		form.setAttribute('hx-trigger', 'nfcResult')
		// changer l'url du POST
		form.setAttribute('hx-post', 'hx_payment')
		// prend en compte les changements dynamiques sur le formulaire
		htmx.process(form)

		// test input exist
		const inputExist = document.querySelector('#nfc-result-tag-id')
		if (inputExist === null) {
			// ajouter le input réceptionnant le tag_id lue par le lecteur nfc
			document.querySelector('#addition-form').insertAdjacentHTML('afterend', `<input class="addition-include-data" id="nfc-result-tag-id" name="tag_id" />`)
		}
	}
</script>

<style>
	#messages {
		position: absolute;
		left: 0;
		top: 0;
		width: 100%;
		height: 100%;
		color: var(--blanc01);
		font-size: 1.5rem;
		text-align: center;
		background-color: var(--bleu09);
	}

	.message-title {
		font-size: 1.5rem;
		font-weight: bold;
	}

	/* button */
	.paiement-bt-total {
		font-size: 1.5rem;
	}
</style>